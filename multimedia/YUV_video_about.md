---
title: YUV格式简介
date: 2018-01-16 22:37:33
category: multimedia
toc: true
---

数字视频常用YUV格式来压缩。本文讲述了YUV视频的一些基本概念，不涉及YUV压缩处理计算。

在电脑图形中我们常会遇到RGB颜色。RGB中的红绿蓝直接分别对应了可见光的部分。
RGB值能建立一个精确的数字坐标系统，称作颜色空间（color space）。红色部分定义了坐标系中的一个轴。
其次是绿色和蓝色。如下图所示。所有有效的RGB值都在这个颜色空间里。
例如洋红色（pure magenta）是 100% blue，100% red， 和 0% green.

![颜色坐标示例 - MSDN](https://msdn.microsoft.com/dynimg/IC167834.gif)

RGB是代表颜色的一种方式。其它坐标系也可以代表颜色。  
YUV是将亮度信息和颜色信息分别编码的一系列颜色空间的统称。和RGB相似，YUV使用3个值来表示颜色。
这3个值称为Y'，U，和V。
（事实上，`YUV`这个称呼在电脑视频中总是指代`Y'CbCr`。然而在本文中`YUV`经常用来指代和`Y'CbCr`相同原理的颜色空间）

`Y'`部分，也称作luma，代表颜色中的`亮度值`。这个记号（`'`）是用来与称为`Y`的luminance（亮度）作区别的。
luminance可从线性RGB值中导出，luma从非线性（gamma-corrected）RGB值中导出。
luminance更接近真实亮度，但luma在技术上更常用。
点记号（`'`）通常被忽略，但YUV颜色空间总是使用luma。

标准定义电视中，luma计算公式为：
```
Y' = 0.299R + 0.587G + 0.114B
```
这个公式揭示了人眼对于特定波长的光更为敏感。蓝色是最暗淡的，绿色是最明亮的，红色处于两者之间。
这个公式也影响了早期电视使用的荧光粉。

现代电视技术使用了更新的公式，用于高清电视
```
Y' = 0.2125R + 0.7154G + 0.0721B
```
公式相关定义可查询`ITU-R BT.601`

U和V部分，称为色度值或颜色区分值。由以下公式计算：
```
U = B - Y'
V = R - Y'
```
这些值能够完整地还原回RBG值。

### YUV的优点
由于历史原因，模拟电视部分使用了YUV格式。模拟彩色电视信号能够兼容以前的黑白电视。
彩色电视信号携带着色度值（U和V）与灰度值。黑白电视忽略色度值，显示出灰度图片。
彩色电视可以提取出色度信息并将信号还原回RGB。

在今天YUV有着另一个优点。相比于亮度的变换，人眼对于色彩的变换更迟钝。那么一张图片中，可以少存放一些色度信息。
例如，通常可以将同水平线（horizontal resolution）上的色度值降为亮度值的一半。
换言之，一行像素中，每2个亮度值共用1个U和V值。
假设每个值是8位，每2个像素需要4个字节来表示（2个Y'，1个U和1个V）。平均下来每个像素用16位来表示。
相当于损失了30%的24位RGB编码。

YUV并没有压缩RGB信息。除非色度值被降低采样率。一个YUV像素和一个RGB像素有着相同的大小。
从RGB换算成YUV并没有损失信息。若没有降采样率，一个YUV像素可以无损地转换回RGB像素。
降低采样率会损失一些颜色信息但能让YUV图像更小。如果处理得当，这种损失是可以接受的。

### 计算机视频中的YUV
上面的YUV并不是数字视频中最准确的转换方式。数字视频通常使用一种称为`Y'CbCr`的YUV格式。
通常，`Y'CbCr`对于YUV的范围是：
```
Y'     16–235
Cb/Cr  16–240, with 128 representing zero
```
上面这些范围以8位`Y'CbCr`为前提。
接下来是`Y'CbCr`的计算过程，使用BT.601的luma定义。

1. RGB值范围是[0,1]。换言之纯黑是0，纯白是1.这些是非线性的RGB值。
2. 计算luma。BT.601中，`Y' = 0.299R + 0.587G + 0.114B`，如前文所述。
3. 计算色度值(B - Y') 和 (R - Y')。这些值范围， (B - Y')范围是 +/- 0.886；(R - Y')范围是+/- 0.701
4. 缩放色度值
```
Pb = (0.5 / (1 - 0.114)) × (B - Y')
Pr = (0.5 / (1 - 0.299)) × (R - Y')
```
这里的缩放因子的设计目的是为了计算得到同样的范围，+/- 0.5。
它们定义了一个称为`Y'PbPr`的YUV颜色空间。这种颜色空间用于模拟信号视频。
5. 通过`Y'PbPr`计算出`Y'CbCr`
```
Y' = 16 + 219 × Y'
Cb = 128 + 224 × Pb
Cr = 128 + 224 × Pr
```
计算得到的值的取值范围就是前面所列的`Y'CbCr`范围。当然也可以直接将RGB值转换为`Y'CbCr`。

## 参考
* About YUV Video - MSDN https://msdn.microsoft.com/en-us/library/windows/desktop/bb530104(v=vs.85).aspx
* Recommended 8-Bit YUV Formats for Video Rendering - MSDN https://msdn.microsoft.com/en-us/library/windows/desktop/dd206750(v=vs.85).aspx
